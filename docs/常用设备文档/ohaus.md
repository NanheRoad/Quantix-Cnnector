# 奥豪斯电子天平 USB 通讯协议说明

> 适用型号：Scout Pro / Scout SE / Navigator / Traveler
> 接口类型：USB（虚拟串口，RS232 协议）
> 数据来源：奥豪斯 USB 接口使用说明书

---

## 1. 通讯架构

### 1.1 接口说明

- 物理接口：USB Type-A
- 逻辑接口：Virtual COM Port（虚拟串口）
- 通讯标准：RS232
- 数据编码：ASCII
- 行结束符：CRLF（`\r\n`）

---

## 2. 串口默认参数

### 2.1 默认配置

| 参数 | 默认值 |
|------|--------|
| 波特率 | 2400 |
| 数据位 | 7 |
| 校验位 | None |
| 停止位 | 1 |
| 握手 | None |

### 2.2 可选配置

| 参数 | 可选值 |
|------|--------|
| 波特率 | 600 / 1200 / 2400 / 4800 / 9600 / 19200 |
| 校验位 | 7-even / 7-odd / 7-none / 8-none |
| 握手 | None / Xon-Xoff / RTS-CTS |

---

## 3. 输出数据协议（设备 → 电脑）

### 3.1 通用规则

- 所有数据为 ASCII 字符
- 每行以 `CRLF` 结束
- 重量字段右对齐
- 不稳定标志为 `?`
- 稳定时该位置为空格

---

## 4. 输出格式定义

### 4.1 Scout Pro（SPx）

#### 格式 1

```
[weight:12][ ][unit:5][ ][stability:1][ ][legend:10]\r\n
```

| 字段 | 长度 | 说明 |
|------|------|------|
| weight | 12 | 右对齐 |
| unit | 5 | 单位 |
| stability | 1 | `?`=不稳定 |
| legend | 10 | 附加信息 |

**示例**

```
********0.00 g
*******12.73 g    ?
***********3 PCS
********0.85 oz     WET WT
```

#### 格式 2（401/601/6000）

```
[weight:11~12][ ][unit:1~5][ ][stability:1][ ][legend:10]\r\n
```

**说明**

- 若重量字符串包含额外小数点 → 12 位
- 否则 → 11 位

---

### 4.2 Navigator（NV/NVL/NVT）

```
[weight:10][ ][unit:1~5][ ][stability:1][ ][NET:0|3][legend:0~16]\r\n
```

**说明**

- 单位字段长度随单位变化
- 可能附加字段：
  - NET
  - 时间
  - UNDER
  - ACCEPT

**示例**

```
*******200 g
********15 g   NET
*******124 g ? NET
********15 g   NET 00:00:02
***5:10.75 lb:oz ? NET ACCEPT 00:00:05
```

---

### 4.3 Traveler（TAx/SE）

```
[weight:11][ ][unit:1~5][ ][stability:1][ ][legend:10]\r\n
```

**示例**

```
******-0.01 g ?
*******4.20 g
```

---

## 5. 输入命令协议（电脑 → 设备）

### 5.1 结束规则

所有命令必须以：

```
CR 或 CRLF
```

即：

```
\r
或
\r\n
```

---

## 6. Scout Pro / Traveler 命令集

| 命令 | 功能 |
|------|------|
| `?` | 打印当前模式 |
| `0A` | 关闭自动打印 |
| `SA` | 自动打印（稳定） |
| `CA` | 自动连续打印 |
| `(n)A` | 每 n 秒自动打印（1-3600） |
| `C` | 量程校准 |
| `L` | 线性校准 |
| `0M` | gram 模式 |
| `1M` | ounce 模式 |
| `2M` | troy ounce |
| `3M` | pennyweight |
| `4M` | 计件模式 |
| `5M` | pound 模式 |
| `T` | 去皮 |
| `V` | 打印软件版本 |
| `EscR` | 恢复出厂 |
| `P` | 打印 |
| `LE` | 打印错误代码 |
| `0S` | 打印不稳定数据 |
| `1S` | 仅打印稳定数据 |

---

## 7. Navigator 命令集

| 命令 | 功能 |
|------|------|
| `P` | 打印 |
| `SP` | 仅打印稳定值 |
| `IP` | 打印当前显示 |
| `CP` | 连续打印 |
| `SLP` | 自动打印非零稳定值 |
| `SLZP` | 自动打印非零稳定值+零点 |
| `xP` | 每 x 秒打印（1-3600） |
| `0P` | 关闭自动打印 |
| `PM` | 打印当前模式 |
| `M` | 切换模式 |
| `PU` | 打印单位 |
| `U` | 切换单位 |
| `T` | 去皮 |
| `Z` | 清零 |
| `PV` | 打印软件版本 |

---

## 8. 自动打印逻辑

### 模式 1

```
USB = on
Auto Print = off
Stable = on/off
```

- 按 PRINT 键发送
- 若 Stable = on → 等待稳定后发送

---

### 模式 2

```
USB = on
Auto Print = on
```

- 自动发送数据
- 若 Stable = on → 仅发送稳定数据

---

### 模式 3

```
USB = off
```

- 接口关闭
- 电池模式下节省电量

---

## 9. AI 解析建议

### 解析步骤

```
1. 读取串口数据
2. 按 CRLF 分割
3. 去除尾部空格
4. 检查是否包含 '?'
5. 提取 weight
6. 提取 unit
7. 提取 legend
```

---

## 10. 推荐结构化输出格式

```json
{
  "weight": 12.73,
  "unit": "g",
  "stable": true,
  "mode": "NET",
  "extra": "ACCEPT",
  "timestamp": "00:00:05"
}
```
