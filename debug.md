# debug.md

> Quantix Connector Bug 修复经验库（持续更新）

## 使用规则
- 每修复一个 Bug，必须新增一条记录，不覆盖历史。
- 新记录追加到文档最上方（倒序：最新在前）。
- 记录必须可复现、可验证、可回归。

## 记录模板（复制后填写）
```md
## [DBG-YYYY-MM-DD-XX] 标题
- 日期：YYYY-MM-DD
- 提交人：姓名/AI
- 影响范围：前端 | 后端 | 驱动 | 数据库 | 部署 | 其他
- 严重级别：P0 | P1 | P2 | P3
- 关联文件：`path/to/file.py`, `path/to/file.ts`

### 1) 现象
- 用户可见表现：
- 日志/报错信息：
- 触发条件：

### 2) 根因
- 直接原因：
- 深层原因（设计/流程/测试缺口）：

### 3) 修复方案
- 核心改动：
- 兼容性影响：
- 是否涉及 API/模板契约变更：是/否（若是，列出变更）

### 4) 验证结果
- 验证命令：
  - `python -m compileall backend frontend config app.py scripts`
  - （补充本次相关命令）
- 关键输出/返回码：
- 手工验证步骤：

### 5) 预防与回归
- 新增测试/脚本/断言：
- 覆盖场景：
- 是否已完成回归防护：是/否
- 若否，计划补齐日期：YYYY-MM-DD

### 6) 经验总结
- 本次应长期保留的工程规则（1-3 条）：
```

---

## [DBG-2026-02-28-03] app.py 中文文本再次出现乱码（UTF-8/GBK 混淆）
- 日期：2026-02-28
- 提交人：AI
- 影响范围：前端
- 严重级别：P1
- 关联文件：`app.py`

### 1) 现象
- 页面 Tab、按钮提示、错误文案出现乱码（如 `璁惧`、`鍗忚`）。
- 影响配置页、协议页、手动控制页可读性和操作确认。

### 2) 根因
- 部分中文文本在历史改动中发生 UTF-8/GBK 混淆，形成“可编译但不可读”的乱码字符串。
- 文件内存在同一模块“正常中文 + 乱码中文”混用，肉眼不易一次识别完整。

### 3) 修复方案
- 对 `app.py` 做乱码识别与定点替换，恢复关键 UI 文案与报错提示中文。
- 对无法自动还原的行进行人工修复（Tab 名、模板字段提示、回调报错文本、底部注释）。
- 清理私有区乱码字符并统一可读注释。

### 4) 验证结果
- 验证命令：
  - `python -m compileall app.py frontend backend config scripts`
- 关键输出/返回码：
  - 返回码 `0`。
- 手工验证步骤：
  - 检查主 Tab、设备创建提示、串口调试错误提示等关键文案是否为正常中文。

### 5) 预防与回归
- 新增流程约束：
  - 每次批量改中文后，除 `compileall` 外增加“乱码扫描”（检测异常高位字符与私有区字符）。
  - 对高风险大文件（如 `app.py`）优先做小范围 patch，避免整段替换导致编码漂移。
- 覆盖场景：
  - 页面文案、提示语、模板预设中文字段。
- 是否已完成回归防护：是

### 6) 经验总结
- “可运行”不等于“可读”；中文可读性应作为回归标准的一部分。
- 乱码修复要结合自动检测和人工校对，单一手段容易漏网。

---

## [DBG-2026-02-28-02] app.py 文本编码污染导致多处字符串未闭合
- 日期：2026-02-28
- 提交人：AI
- 影响范围：前端
- 严重级别：P1
- 关联文件：`app.py`

### 1) 现象
- 运行 `python -m compileall ...` 时 `app.py` 多次报 `unterminated string literal`、`f-string` 语法错误。
- 错误集中在含中文提示文案的位置，导致应用无法启动。

### 2) 根因
- 编辑过程中发生文本编码污染，部分中文字符串被破坏，丢失结束引号或插值括号。
- 缺少“文案字符串完整性”检查，问题在运行阶段才暴露。

### 3) 修复方案
- 逐段替换损坏字符串为稳定文案，并重写受损严重函数文案块。
- 修复后统一执行编译检查，确保语法层面恢复。

### 4) 验证结果
- 验证命令：
  - `python -m compileall backend frontend config app.py scripts`
- 关键输出/返回码：
  - 返回码 `0`，无语法错误。
- 手工验证步骤：
  - 打开 `app.py` 对应函数，确认所有字符串均闭合且 f-string 可正常解析。

### 5) 预防与回归
- 新增流程约束：
  - 涉及大量中文文案变更时，必须立即跑一次 `compileall`。
  - 对单文件多次替换后，优先局部编译 `python -m compileall app.py` 再跑全量。
- 覆盖场景：
  - Dash 回调文案、模板预设、串口调试提示文本。
- 是否已完成回归防护：是

### 6) 经验总结
- 编码问题会伪装成“随机语法错误”，应优先做编译级快速定位。
- 文案密集文件要采用“小步修改 + 小步编译”的节奏。

## [DBG-2026-02-28-01] AGENTS.md 文档乱码导致规则不可读
- 日期：2026-02-28
- 提交人：AI
- 影响范围：工程流程
- 严重级别：P2
- 关联文件：`AGENTS.md`, `debug.md`

### 1) 现象
- `AGENTS.md` 出现大量乱码，团队无法稳定读取规范。
- 规则无法被准确执行，易引发流程偏差。

### 2) 根因
- 文档编码/读写链路不一致，导致中文内容显示异常。
- 缺少“文档可读性”作为交付检查项。

### 3) 修复方案
- 重写 `AGENTS.md`，恢复为可读中文并补充“持续进化”章节。
- 新增 `debug.md`，统一 Bug 复盘模板与沉淀标准。

### 4) 验证结果
- 验证命令：
  - `python -m compileall backend frontend config app.py scripts`
- 关键输出/返回码：
  - 待下次代码变更时统一执行（本次仅文档改动）。
- 手工验证步骤：
  - 打开 `AGENTS.md` 与 `debug.md`，确认结构完整、字段齐全、可直接复用。

### 5) 预防与回归
- 新增流程约束：
  - 每次任务完成后检查 `AGENTS.md` 是否需补充。
  - 每次修 Bug 后写入 `debug.md`。
- 覆盖场景：
  - 功能开发、重构、缺陷修复全流程。
- 是否已完成回归防护：是

### 6) 经验总结
- 规范文档本身是生产资产，必须纳入质量门禁。
- 经验沉淀必须标准化，否则无法形成复用能力。
